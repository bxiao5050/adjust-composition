<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
	<style>
		#rg-bg-login {
			position: absolute;
			width: 100%;
			height: 100%;
			top: 0;
			left: 0;
			display: none;
		}
	</style>
</head>

<body>
	<img id="rg-bg-login" />
	<script>
		/**
		 * GET 参数获取
		 * @param name 参数名称
		 */
		var getUrlParam = (function () {
			var urlParamMap = {}
			var urlParamKeyArr = []
			var interrogationIndex = location.href.indexOf("?") + 1
			var str = interrogationIndex === 0 ? "" : location.href.slice(interrogationIndex)
			if (str) {
				var arr = str.split(/&|%26/)
				arr.forEach(function (item) {
					var arr = item.split(/=|%3D/)
					var key = arr[0]
					var val = arr[1]
					urlParamMap[key] = val
					urlParamKeyArr.push(key)
				})
			}
			return function (name) {
				if (name) {
					return urlParamMap.hasOwnProperty(name) ? urlParamMap[name] : null
				} else {
					return urlParamKeyArr
				}
			}
		})()
		/** 加载jssdk */
		var src = './sdk.js?t=' + getUrlParam('t');
		(function (d, s, id) {
			var js
			if (d.getElementById(id)) return;
			js = d.createElement(s);
			js.id = id;
			js.src = src
			js.onload = function () {
				console.log('loaded')
				window.RG = {
					gameConfig: function (config) {
						console.log(config);
						let img = document.getElementById('rg-bg-login')
						img.src = config.pic.loginBg
						img.style.display = 'block'
					}
				}
			}
			document.body.appendChild(js)
		}(document, 'script', 'rg-jssdk'));

		window.rgAsyncInit = function () {
			var urlParamKeyArr = getUrlParam()
			var urlSearch = ''
			var $i = 0
			for (var key of urlParamKeyArr) {
				if (key === 'type') {
					continue
				} else {
					urlSearch += (($i ? '&' : '?') + key + '=' + getUrlParam(key))
					$i++
				}
			}
			var user = encodeURIComponent(JSON.stringify(
				RG.CurUserInfo()
			))
			urlSearch += '&user=' + user;
			var href = ((getUrlParam('debugger') || window.debugger) ? RG.jssdk.config.page.game.test : RG.jssdk.config.page.game
				.formal) + urlSearch;
			console.log('window.rgAsyncInit', href)
			location.href = href
		}
	</script>
</body>

</html>